import{bn as e,bo as xe,bp as fe,bq as je,r as i,br as Ce,bs as Se,bt as ye,bu as ae,bv as be,bw as we,bx as ve,by as Te,bz as Ne,bA as Le,bB as ke,bC as Ae,bD as Ie}from"./vendor-c238243a.js";import{S as Me,E as Pe,a as qe,b as Ee,D as Be,c as Re}from"./fluentui-icons-58716126.js";import{S as _,I as ze,P as $e,T as oe,a as Oe,B as K,b as Fe,c as He,D as Qe,d as Ge,e as De,C as te,f as Ve,g as Ue}from"./fluentui-react-1d44cebd.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&d(u)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();const Ke="_layout_1dkox_1",We="_header_1dkox_7",Je="_headerContainer_1dkox_12",Xe="_headerTitleContainer_1dkox_20",Ye="_headerLogo_1dkox_28",Ze="_headerTitle_1dkox_20",et="_headerRightText_1dkox_37",I={layout:Ke,header:We,headerContainer:Je,headerTitleContainer:Xe,headerLogo:Ye,headerTitle:Ze,headerRightText:et},tt=()=>e.jsxs("div",{className:I.layout,children:[e.jsx("header",{className:I.header,role:"banner",children:e.jsxs("div",{className:I.headerContainer,children:[e.jsx(xe,{to:"/",className:I.headerTitleContainer,children:e.jsx("h3",{className:I.headerTitle,children:"RAG on database"})}),e.jsx("h4",{className:I.headerRightText,children:"OpenAI + PostgreSQL"})]})}),e.jsx(fe,{})]}),st="_container_ggo0d_1",nt="_chatRoot_ggo0d_8",at="_chatContainer_ggo0d_13",ot="_chatEmptyState_ggo0d_21",rt="_chatEmptyStateTitle_ggo0d_31",it="_chatEmptyStateSubtitle_ggo0d_38",ct="_chatMessageStream_ggo0d_54",lt="_chatMessageGpt_ggo0d_66",dt="_chatMessageGptMinWidth_ggo0d_73",ht="_chatInput_ggo0d_78",ut="_chatAnalysisPanel_ggo0d_91",pt="_chatSettingsSeparator_ggo0d_99",gt="_loadingLogo_ggo0d_105",mt="_commandsContainer_ggo0d_109",_t="_commandButton_ggo0d_114",l={container:st,chatRoot:nt,chatContainer:at,chatEmptyState:ot,chatEmptyStateTitle:rt,chatEmptyStateSubtitle:it,chatMessageStream:ct,chatMessageGpt:lt,chatMessageGptMinWidth:dt,chatInput:ht,chatAnalysisPanel:ut,chatSettingsSeparator:pt,loadingLogo:gt,commandsContainer:mt,commandButton:_t};var y=(t=>(t.Hybrid="hybrid",t.Vectors="vectors",t.Text="text",t))(y||{});const xt="_answerContainer_qz1fg_1",ft="_answerLogo_qz1fg_11",jt="_answerText_qz1fg_15",Ct="_selected_qz1fg_34",St="_referenceMetadata_qz1fg_38",yt="_citationLearnMore_qz1fg_43",bt="_citation_qz1fg_43",wt="_followupQuestionsList_qz1fg_65",vt="_followupQuestionLearnMore_qz1fg_69",Tt="_followupQuestion_qz1fg_65",Nt="_supContainer_qz1fg_88",Lt="_retryButton_qz1fg_117",kt="_loadingdots_qz1fg_139",At="_loading_qz1fg_139",m={answerContainer:xt,answerLogo:ft,answerText:jt,selected:Ct,referenceMetadata:St,citationLearnMore:yt,citation:bt,followupQuestionsList:wt,followupQuestionLearnMore:vt,followupQuestion:Tt,supContainer:Nt,retryButton:Lt,loadingdots:kt,loading:At};function It(t,s,r){const d=[];let n=t.trim();if(s){let g=n.length;for(let p=n.length-1;p>=0&&n[p]!=="]";p--)if(n[p]==="["){g=p;break}n=n.substring(0,g)}return{answerHtml:n.split(/\[([^\]]+)\]/g).map((g,C)=>{if(C%2===0)return g;{let p;return d.indexOf(g)!==-1?p=d.indexOf(g)+1:(d.push(g),p=d.length),je(e.jsx("a",{className:"supContainer",title:g,children:e.jsx("sup",{children:p})}))}}).join(""),citations:d}}const re=()=>e.jsx(Me,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),se=({answer:t,isSelected:s,isStreaming:r,onCitationClicked:d,onThoughtProcessClicked:n,onSupportingContentClicked:c,onFollowupQuestionClicked:u,showFollowupQuestions:g})=>{const C=t.context.followup_questions,p=t.message.content,h=i.useMemo(()=>It(p,r),[t]),v=Ce.sanitize(h.answerHtml);return e.jsxs(_,{className:`${m.answerContainer} ${s&&m.selected}`,verticalAlign:"space-between",children:[e.jsx(_.Item,{children:e.jsxs(_,{horizontal:!0,horizontalAlign:"space-between",children:[e.jsx(re,{}),e.jsx("div",{children:e.jsx(ze,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>n(),disabled:!t.context.thoughts?.length})})]})}),e.jsx(_.Item,{grow:!0,children:e.jsx("div",{className:m.answerText,dangerouslySetInnerHTML:{__html:v}})}),!!h.citations.length&&e.jsx(_.Item,{children:e.jsxs(_,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e.jsx("span",{className:m.citationLearnMore,children:"References:"}),e.jsx("ol",{children:h.citations.map((S,L)=>{const x=t.context.data_points[S];return x?e.jsxs("li",{children:[e.jsx("h4",{children:x.name}),e.jsxs("p",{className:m.referenceMetadata,children:["Brand: ",x.brand]}),e.jsxs("p",{className:m.referenceMetadata,children:["Price: ",x.price]}),e.jsx("p",{children:x.description})]},S):null})})]})}),!!C?.length&&g&&u&&e.jsx(_.Item,{children:e.jsxs(_,{horizontal:!0,wrap:!0,className:`${h.citations.length?m.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e.jsx("span",{className:m.followupQuestionLearnMore,children:"Follow-up questions:"}),C.map((S,L)=>e.jsx("a",{className:m.followupQuestion,title:S,onClick:()=>u(S),children:`${S}`},L))]})})]})},Mt=()=>{const t=Se({from:{opacity:0},to:{opacity:1}});return e.jsx(ye.div,{style:{...t},children:e.jsxs(_,{className:m.answerContainer,verticalAlign:"space-between",children:[e.jsx(re,{}),e.jsx(_.Item,{grow:!0,children:e.jsxs("p",{className:m.answerText,children:["Generating answer",e.jsx("span",{className:m.loadingdots})]})})]})})},Pt=({error:t,onRetry:s})=>e.jsxs(_,{className:m.answerContainer,verticalAlign:"space-between",children:[e.jsx(Pe,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e.jsx(_.Item,{grow:!0,children:e.jsx("p",{className:m.answerText,children:t})}),e.jsx($e,{className:m.retryButton,onClick:s,text:"Retry"})]}),qt="_questionInputContainer_hiipw_1",Et="_questionInputTextArea_hiipw_12",Bt="_questionInputButtonsContainer_hiipw_17",V={questionInputContainer:qt,questionInputTextArea:Et,questionInputButtonsContainer:Bt},Rt=({onSend:t,disabled:s,placeholder:r,clearOnSend:d,initQuestion:n})=>{const[c,u]=i.useState("");i.useEffect(()=>{n&&u(n)},[n]);const g=()=>{s||!c.trim()||(t(c),d&&u(""))},C=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),g())},p=(h,v)=>{v?v.length<=1e3&&u(v):u("")};return e.jsxs(_,{horizontal:!0,className:V.questionInputContainer,children:[e.jsx(oe,{className:V.questionInputTextArea,placeholder:r,multiline:!0,resizable:!1,borderless:!0,value:c,onChange:p,onKeyDown:C}),e.jsx("div",{className:V.questionInputButtonsContainer,children:e.jsx(Oe,{content:"Ask question button",relationship:"label",children:e.jsx(K,{size:"large",icon:e.jsx(qe,{primaryFill:"rgba(115, 118, 225, 1)"}),onClick:g})})})]})},zt="_examplesNavList_bnsga_1",$t="_example_bnsga_1",Ot="_exampleText_bnsga_29",U={examplesNavList:zt,example:$t,exampleText:Ot},Ft=({text:t,value:s,onClick:r})=>e.jsx("div",{className:U.example,onClick:()=>r(s),children:e.jsx("p",{className:U.exampleText,children:t})}),Ht=["Best shoe for hiking?","Climbing gear cheaper than $30?","Waterproof camping gear?"],Qt=({onExampleClicked:t})=>e.jsx("ul",{className:U.examplesNavList,children:Ht.map((s,r)=>e.jsx("li",{children:e.jsx(Ft,{text:s,value:s,onClick:t})},r))}),Gt="_container_1p3pb_1",Dt="_message_1p3pb_9",ne={container:Gt,message:Dt},O=({message:t})=>e.jsx("div",{className:ne.container,children:e.jsx("div",{className:ne.message,children:t})}),Vt="_thoughtProcess_1ooqd_1",Ut="_tList_1ooqd_8",Kt="_tListItem_1ooqd_14",Wt="_tStep_1ooqd_40",Jt="_tCodeBlock_1ooqd_47",Xt="_tProp_1ooqd_51",Yt="_citationImg_1ooqd_60",B={thoughtProcess:Vt,tList:Ut,tListItem:Kt,tStep:Wt,tCodeBlock:Jt,tProp:Xt,citationImg:Yt};var N=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(N||{});ae.registerLanguage("json",be);const Zt=({thoughts:t})=>e.jsx("ul",{className:B.tList,children:t.map((s,r)=>e.jsxs("li",{className:B.tListItem,children:[e.jsx("div",{className:B.tStep,children:s.title}),e.jsx(_,{horizontal:!0,tokens:{childrenGap:5},children:s.props&&(Object.keys(s.props)||[]).map(d=>e.jsxs("span",{className:B.tProp,children:[d,": ",JSON.stringify(s.props?.[d])]}))}),Array.isArray(s.description)?e.jsx(ae,{language:"json",wrapLongLines:!0,className:B.tCodeBlock,style:we,children:JSON.stringify(s.description,null,2)}):e.jsx("div",{children:s.description})]},r))});const es={disabled:!0,style:{color:"grey"}},ts=({answer:t,activeTab:s,activeCitation:r,citationHeight:d,className:n,onActiveTabChanged:c})=>{const u=!t.context.thoughts;t.context.data_points;const[g,C]=i.useState(""),p=async()=>{if(r){const h=r.indexOf("#")?r.split("#")[1]:"",S=await(await fetch(r,{method:"GET"})).blob();let L=URL.createObjectURL(S);h&&(L+="#"+h),C(L)}};return i.useEffect(()=>{p()},[]),e.jsx(Fe,{className:n,selectedKey:s,onLinkClick:h=>h&&c(h.props.itemKey),children:e.jsx(He,{itemKey:N.ThoughtProcessTab,headerText:"Thought process",headerButtonProps:u?es:void 0,children:e.jsx(Zt,{thoughts:t.context.thoughts||[]})})})},ss="_container_cfwv2_1",ns={container:ss},as=({className:t,onClick:s})=>e.jsx("div",{className:`${ns.container} ${t??""}`,children:e.jsx(K,{icon:e.jsx(Ee,{}),onClick:s,children:"Developer settings"})}),os="_container_cfwv2_1",rs={container:os},is=({className:t,disabled:s,onClick:r})=>e.jsx("div",{className:`${rs.container} ${t??""}`,children:e.jsx(K,{icon:e.jsx(Be,{}),disabled:s,onClick:r,children:"Clear chat"})}),cs="_container_1pzrp_1",ls={container:cs},ds=({updateRetrievalMode:t})=>{const[s,r]=i.useState(y.Hybrid),d=(n,c)=>{r(c?.data||y.Hybrid),t(c?.data||y.Hybrid)};return e.jsx(_,{className:ls.container,tokens:{childrenGap:10},children:e.jsx(Qe,{label:"Retrieval mode",options:[{key:"hybrid",text:"Vectors + Text (Hybrid)",selected:s==y.Hybrid,data:y.Hybrid},{key:"vectors",text:"Vectors",selected:s==y.Vectors,data:y.Vectors},{key:"text",text:"Text",selected:s==y.Text,data:y.Text}],required:!0,onChange:d})})},hs=()=>{const[t,s]=i.useState(!1),[r,d]=i.useState(""),[n,c]=i.useState(.3),[u,g]=i.useState(3),[C,p]=i.useState(y.Hybrid),[h,v]=i.useState(!0),[S,L]=i.useState(!0),x=i.useRef(""),F=i.useRef(null),[R,z]=i.useState(!1),[W,H]=i.useState(!1),[$,Q]=i.useState(),[J,G]=i.useState(),[M,k]=i.useState(void 0),[P,X]=i.useState(0),[b,D]=i.useState([]),[Y,Z]=i.useState([]),ie=async(a,o,f)=>{let A="",w={context:{data_points:{},followup_questions:null,thoughts:[]},message:{content:"",role:"assistant"}};const T=j=>new Promise(me=>{setTimeout(()=>{A+=j;const _e={...w,message:{content:A,role:w.message.role}};Z([...o,[a,_e]]),me(null)},33)});try{H(!0);for await(const j of f)j.context&&(w.context={...w.context,...j.context}),j.delta&&j.delta.role&&(w.message.role=j.delta.role),j.delta&&j.delta.content&&(z(!1),await T(j.delta.content))}finally{H(!1)}return w.message.content=A,w},q=async a=>{x.current=a,$&&Q(void 0),z(!0),G(void 0),k(void 0);try{const f=[...b.flatMap(T=>[{content:T[0],role:"user"},{content:T[1].message.content,role:"assistant"}]),{content:a,role:"user"}],A={context:{overrides:{use_advanced_flow:h,top:u,retrieval_mode:C,prompt_template:r.length===0?void 0:r,temperature:n}},sessionState:b.length?b[b.length-1][1].sessionState:null},w=new ve("/chat");if(S){const T=await w.getStreamedCompletion(f,A),j=await ie(a,b,T);D([...b,[a,j]])}else{const T=await w.getCompletion(f,A);D([...b,[a,T]])}}catch(o){Q(o)}finally{z(!1)}},ce=()=>{x.current="",$&&Q(void 0),G(void 0),k(void 0),D([]),Z([]),z(!1),H(!1)};i.useEffect(()=>F.current?.scrollIntoView({behavior:"smooth"}),[R]),i.useEffect(()=>F.current?.scrollIntoView({behavior:"auto"}),[Y]);const le=(a,o)=>{d(o||"")},de=(a,o,f)=>{c(a)},he=(a,o)=>{g(parseInt(o||"3"))},ue=(a,o)=>{v(!!o)},pe=(a,o)=>{L(!!o)},ge=a=>{q(a)},ee=(a,o)=>{J===a&&M===N.CitationTab&&P===o?k(void 0):(G(a),k(N.CitationTab)),X(o)},E=(a,o)=>{k(M===a&&P===o?void 0:a),X(o)};return e.jsxs("div",{className:l.container,children:[e.jsxs("div",{className:l.commandsContainer,children:[e.jsx(is,{className:l.commandButton,onClick:ce,disabled:!x.current||R}),e.jsx(as,{className:l.commandButton,onClick:()=>s(!t)})]}),e.jsxs("div",{className:l.chatRoot,children:[e.jsxs("div",{className:l.chatContainer,children:[x.current?e.jsxs("div",{className:l.chatMessageStream,children:[W&&Y.map((a,o)=>e.jsxs("div",{children:[e.jsx(O,{message:a[0]}),e.jsx("div",{className:l.chatMessageGpt,children:e.jsx(se,{isStreaming:!0,answer:a[1],isSelected:!1,onCitationClicked:f=>ee(f,o),onThoughtProcessClicked:()=>E(N.ThoughtProcessTab,o),onSupportingContentClicked:()=>E(N.SupportingContentTab,o),onFollowupQuestionClicked:f=>q(f)},o)})]},o)),!W&&b.map((a,o)=>e.jsxs("div",{children:[e.jsx(O,{message:a[0]}),e.jsx("div",{className:l.chatMessageGpt,children:e.jsx(se,{isStreaming:!1,answer:a[1],isSelected:P===o&&M!==void 0,onCitationClicked:f=>ee(f,o),onThoughtProcessClicked:()=>E(N.ThoughtProcessTab,o),onSupportingContentClicked:()=>E(N.SupportingContentTab,o),onFollowupQuestionClicked:f=>q(f)},o)})]},o)),R&&e.jsxs(e.Fragment,{children:[e.jsx(O,{message:x.current}),e.jsx("div",{className:l.chatMessageGptMinWidth,children:e.jsx(Mt,{})})]}),$?e.jsxs(e.Fragment,{children:[e.jsx(O,{message:x.current}),e.jsx("div",{className:l.chatMessageGptMinWidth,children:e.jsx(Pt,{error:$.toString(),onRetry:()=>q(x.current)})})]}):null,e.jsx("div",{ref:F})]}):e.jsxs("div",{className:l.chatEmptyState,children:[e.jsx(Re,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e.jsx("h1",{className:l.chatEmptyStateTitle,children:"Product chat"}),e.jsx("h2",{className:l.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e.jsx(Qt,{onExampleClicked:ge})]}),e.jsx("div",{className:l.chatInput,children:e.jsx(Rt,{clearOnSend:!0,placeholder:"Type a new question (e.g. does my plan cover annual eye exams?)",disabled:R,onSend:a=>q(a)})})]}),b.length>0&&M&&e.jsx(ts,{className:l.chatAnalysisPanel,activeCitation:J,onActiveTabChanged:a=>E(a,P),citationHeight:"810px",answer:b[P][1],activeTab:M}),e.jsxs(Ge,{headerText:"Configure answer generation",isOpen:t,isBlocking:!1,onDismiss:()=>s(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e.jsx(De,{onClick:()=>s(!1),children:"Close"}),isFooterAtBottom:!0,children:[e.jsx(te,{className:l.chatSettingsSeparator,checked:h,label:"Use advanced flow with query rewriting and filter formulation. Not compatible with Ollama models.",onChange:ue}),e.jsx("h3",{children:"Settings for database search:"}),e.jsx(Ve,{className:l.chatSettingsSeparator,label:"Retrieve this many matching rows:",min:1,max:50,defaultValue:u.toString(),onChange:he}),e.jsx(ds,{updateRetrievalMode:a=>p(a)}),e.jsx("h3",{children:"Settings for final chat completion:"}),e.jsx(oe,{className:l.chatSettingsSeparator,defaultValue:r,label:"Override prompt template",multiline:!0,autoAdjustHeight:!0,onChange:le}),e.jsx(Ue,{className:l.chatSettingsSeparator,label:"Temperature",min:0,max:1,step:.1,defaultValue:n,onChange:de,showValue:!0,snapToStep:!0}),e.jsx(te,{className:l.chatSettingsSeparator,checked:S,label:"Stream chat completion responses",onChange:pe})]})]})]})};var us=e.jsx(tt,{});Te();const ps=Ne([{path:"/",element:us,children:[{index:!0,element:e.jsx(hs,{})},{path:"*",lazy:()=>Ie(()=>import("./NoPage-42b78e1a.js"),["assets/NoPage-42b78e1a.js","assets/vendor-c238243a.js"])}]}]);Le.createRoot(document.getElementById("root")).render(e.jsx(ke.StrictMode,{children:e.jsx(Ae,{router:ps})}));
//# sourceMappingURL=index-206aa545.js.map
